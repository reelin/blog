<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>MiaoWuwu | I Like Green</title>

    <link rel="stylesheet" type="text/less" href="/stylesheets/styles.less">
    
    <meta name="viewport" post="width=device-width, initial-scale=1, user-scalable=no">
    
    <script src="/javascripts/scale.fix.js"></script>
    <script type="text/javascript" src="/javascripts/jquery-1.7.2.min.js"></script>
    <script src="/javascripts/less-1.3.0.min.js" type="text/javascript"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body>
    <header>
        <ul>
            <li><a id="logo" href="/">喵呜呜</a></li>
            <li>
                <a href="/index.html">Blog</a>
            </li>
            <li>
                <a href="/demo.html">Demos</a>
            </li>
            <li>
                <a href="#">About</a>
            </li>
        </ul>

    </header>
    <div class="wrapper">        

        <div id="github">
    <h1>Dragable cat 2</h1>
    <div class="content">
    	<div><p>将之前的代码重构一下，写成一个Element的扩展drag，当给drag传入true时，元素则可拖拽，传入false则取消可拖拽状态。</p>

<p><a href="\code\exam\ex14.html">拖动更多的小猫，哈哈~~~</a></p>

<pre><code>/*
* 使用方法： 
* document.getElementById("ID").drag(true);
*/
(function (d) {

        Element.prototype.drag = function(flag) {
            var element = this,
                elementX = 0,
                elementY = 0,
                originMouseX = 0,
                originMouseY = 0,
                isMoving = false;

            element.onmousedown = function(e) {
                e.preventDefault();
                if (flag) {
                    var xy = getXY(e);
                    elementX = _getComputedStyle(element, 'left');
                    elementY = _getComputedStyle(element, 'top');
                    originMouseX = xy.x;
                    originMouseY = xy.y;
                    isMoving = true;
                }
            }

            document.addEventListener("mousemove", function(e) {
                e.preventDefault();
                var xy = getXY(e);
                if (isMoving) {  
                    element.style.left = elementX + (xy.x - originMouseX) + "px";
                    element.style.top = elementY + (xy.y - originMouseY) + "px";
                }
            }, false);

            element.onmouseup = function(e) {
                e.preventDefault();
                var xy = getXY(e);
                isMoving = false;
                originMouseX = xy.x;
                originMouseY = xy.y;
                elementX = _getComputedStyle(element, 'left');
                elementY = _getComputedStyle(element, 'top');
            }


            // 获取时间中鼠标的坐标，以{x: ,y: }的形式返回
            function getXY(e) {
                var xy = {};
                if (window.event) {
                    xy.x = window.event.clientX;
                    xy.y = window.event.clientY;
                } else {
                    xy.x = e.pageX;
                    xy.y = e.pageY;
                }
                return xy;
            }

            // 获取Element对象的一个样式属性值
            function _getComputedStyle(element, property) {
                return parseInt(window.getComputedStyle(element, null)[property]);
            }
        }
    }(document));
</code></pre>

<ul>
<li><p>小猫是绝对定位的哦~~而且有top，left的值</p></li>
<li><p>添加多了一只小猫，让cat1可拖动，然后拖动后，让cat2可拖动，然后再拖动cat1，就不行了。在高手的指点下，得到一颗明星addEventListener()</p>

<ul>
<li>能通过多次调用addEventListener()为同一个对象注册同一事件类型的多个处理程序函数。(犀牛书)</li>
</ul>
</li>
<li><p>给document添加addEventListener()后，小猫可以轮着拖动咯~~</p></li>
</ul>


<hr />

<p>尊重原创，引用请标注出处，谢谢！</p>
</div>
    	<p class="data">Posted on 15 September 2012</p>
    </div>
</div>


        
        <footer>
            <p>Hosted on GitHub Pages — Theme by <a class="header name" href="https://github.com/reelin">reelin</a></p>
        </footer>
    </div>

<script type="text/javascript" src="/javascripts/base.js"></script>

<!--[if !IE]><script>fixScale(document);</script><![endif]-->
</body>
</html>