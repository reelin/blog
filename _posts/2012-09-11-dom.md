---
layout: post
title: Dom操作
---

	<!DOCTYPE HTML>
	<html lang="en-US">
	<head>
	    <meta charset="UTF-8">
	    <title></title>
	    <style type="text/css">
	        /* basic style */
	        #items {
	            width: 200px;
	            padding: 5px 5px 5px 30px;
	            border: 1px solid #dddddd;
	            overflow: hidden;
	        }
	        .item {
	            margin-bottom: 3px;
	            padding: 2px;
	        }
	        .rules {
	            font-size: 12px;
	        }
	        /* 选中状态样式 */
	        .selected {
	            border: 1px dashed #dddddd;
	        }
	    </style>
	    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.1.min.js"></script>
	</head>
	<body>
	    <ul id="items">
	        <li class="item">item 1</li>
	        <li class="item">item 2</li>
	        <li class="item">item 3</li>
	        <li class="item">item 4</li>
	        <li class="item">item 5</li>
	    </ul>
	    <div>
	        <input type="text" id="item_name">
	        <button id="add">添加</button> | 
	        <button id="delete">删除</button> | 
	        <button id="all_delete">全部删除</button>
	    </div>
	    <p>
	        规则：
	    </p>
	    <ol class="rules">
	        <li>在输入框中输入新item名后点击添加按钮，则在列表最后添加新item。</li>
	        <li>单击item，item被选中，再次单击则取消选中。选中状态类名为selected。</li>
	        <li>点击删除按钮，则删除列表中被选中的item。未选中任何item，则弹出'未选中任何item'提示。</li>
	        <li>点击全部删除按钮，则删除列表中的全部item。</li>
	    </ol>
	    <script type="text/javascript" src="11.js"></script>
	</body>
	</html>
	
---

javascript实现：
	
	(function() {
		var button = document.getElementsByTagName("button"),
			addBtn = button[0],
			deleteBtn = button[1],
			allDeleteBtn = button[2],
			items = document.getElementById("items");

		// 创建一个新的item节点
		function createItem() {
			var newText = document.createTextNode("item " + (items.children.length+1) ),
				newItem = document.createElement("li");

			newItem.appendChild(newText);
			newItem.className = ("item");

			return newItem;
		}

		// 在input里面输入item，点击添加则添加一个新的item节点
		addBtn.onclick = function () {
		var itemValue = document.getElementById("item_name").value;

			if (itemValue == "item") {
				newItem = createItem();
				items.appendChild(newItem);

				// 给新添加的节点添加事件
				newItem.onclick = addSelected;

			}
		};

		// 点击删除则删除选中的item
		deleteBtn.onclick = function() {
			var selected = document.getElementsByClassName("selected"),
				selectedNum = selected.length;

			// 未选中则提示
			if (selectedNum == 0) {
				alert("未选中任何item");
				return;
			} else {
				// 在删除后selected类元素的长度在不断变化
				while (document.getElementsByClassName("selected").length > 0) {
					items.removeChild(selected[0]);
				};
			}
		};

		// 删除全部item节点
		allDeleteBtn.onclick = function() {
			while (items.children.length > 0) {
				items.removeChild(items.children[0]);
			}
		};

		// 给每个有selected类的节点添加onclick事件
		for (var i = 0; i < items.children.length; i ++) {
			console.log(items.children.length);
			items.children[i].onclick = addSelected;
		}

		// 添加selected类
		function addSelected() {
			if (this.className === "item") {
				this.className = this.className + " selected";
			} else {
				this.className = "item";
			}
		};
	}());

jQuery实现：

	(function ($) {
		var items = $("#items"),
			itemNum = $(".item").length;

		function addSelecte() {
			var that = $(this);
			if (that.hasClass("selected")) {
				that.removeClass("selected");
			} else {
				that.addClass("selected");
			}
		}

		$("#add").click(function() {
			var input = $("#item_name");
			
			if (input[0].value === "item") {
				var newItem = $('<li class="item">item ' + (itemNum+1) + '</li>');
				items.append(newItem);

				itemNum += 1;
			}
		});

		$(".item").live('click', addSelecte);

		$("#delete").click(function() {
			itemNum -= $(".selected").length;
			$(".selected").remove();
		});

		$("#all_delete").click(function() {
			$(".item").remove();
			itemNum = 0;
		});
	}(jQuery));

用JS实现的时候遇到几个问题：

1.	传入的item的序号问题。一开始添加出来的都是Item6,后来调试发现忘记赋值给外函数的变量itemNum.
2.	添加后的item元素都不能添加selected类。给添加后的元素也增加监听的事件，然后OK了。
3. 删除selected类元素的时候，总是有剩余。调试后发现每次删除后.selected的长度都在变化，用了一个猥琐的方法，长度>0的时候，就一直删除第0个。更好的方法是在删除后，将i--，因为删除的元素的下一个元素代替了删除的元素。

用jQuery实现的话，方法和之前是一样的，不过就是一些函数的使用。

*	js中的添加节点`appendChild` 与 jquery的`append`
*	js中的删除节点`removeChild` 与 jquery的`remove`
*	js中的替换节点`replaceChild` 与 jquery的`replace`
*	js中的`className`元素的类名
*	jquery的`hasClass`查看该元素是否有该类
*	jquery的`addClass`添加类
*	jquery的`removeClass`删除已有的类
*	以及jquery中live绑定和bind绑定的区别
	*	live绑定的元素事件不仅有当前HTML里面的元素，也能将新增加的元素进行绑定
	*	bind只能绑定文件加载后的HTML里面的元素，不能是新增的

---
尊重原创，引用请标注出处，谢谢！







